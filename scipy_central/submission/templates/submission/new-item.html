{% extends "page-base.html" %}

{% block title %}{{pagetitle}}{% endblock %}

{% block pageContent %}
{% load widget_tweaks %}

<script>
//JQuery example: http://jqueryui.com/demos/autocomplete/#multiple-remote
$(function() {
	function split( val ) {
		return val.split( /,\s*/ );
	}
	function extractLast( term ) {
		return split( term ).pop();
	}

	$(".spc-autocomplete")
		// don't navigate away from the field on tab when selecting an item
		.bind( "keydown", function( event ) {
			if ( event.keyCode === $.ui.keyCode.TAB &&
					$( this ).data( "autocomplete" ).menu.active ) {
				event.preventDefault();
			}
		})
		.autocomplete({
			source: function( request, response ) {
				$.getJSON( "{% url spc-tagging-ajax %}", {
					term: extractLast( request.term )
				}, response );
			},
			search: function() {
				// custom minLength
				var term = extractLast( this.value );
				if ( term.length < 1 ) {
					return false;
				}
			},
			focus: function() {
				// prevent value inserted on focus
				return false;
			},
			select: function( event, ui ) {
				var terms = split( this.value );
				// remove the current input
				terms.pop();
				// add the selected item
				terms.push( ui.item.value );
				// add placeholder to get the comma-and-space at the end
				terms.push( "" );
				this.value = terms.join( ", " );
				return false;
			}
		});
});
</script>

<div class="row-fluid">
<div class="span12">
	<div class="row-fluid">
		<div class="span12 spc-page-title" style="padding-bottom:25px;">
			<h3>Submit Code or Snippet or Link</h3>
		</div>
	</div>
	<div class="row-fluid">
		<form action="" method="POST" class="spc-ul-form" enctype="multipart/form-data">
		{% csrf_token %}
		
		{% if item.errors %}
			<div class="alert alert-error">
				<button type="button" class="close" data-dismiss="alert">&times;</button>
				<p><b>Some errors were found</b>. Please see fields with a coloured background</p>
			</div>
		{% endif %}
		
		{% for field in item %}
			{% if field.is_hidden %}
				{{field.as_widget|safe}}
			{% else %}
				<div class="control-group {% if field.errors %}control-group error{% endif %}">
					<label class="control-label" for="{{field.id_for_label}}">{{field.label|upper|safe}}</label>
					<div class="controls">
						{{field|add_class:"span12"|safe}}
						{% if field.errors %}
							<div class="alert alert-error">{{field.errors|safe}}</div>
						{% endif %}
						{% if field.help_text %}
							<div class="alert alert-info"><p>{{field.help_text|safe}}</p></div>
						{% endif %}
					</div>
				</div>
			{% endif %}
		{% endfor %}
		
		<div class="control-group">
			<div class="controls">
				<button class="btn btn-primary btn-block" type="submit"  name="spc-preview">{{buttontext}}</button>
				{{buttontext_extra}}
			</div>
		</div>
		
		</form>
	</div><!--/row-fluid-->
	
	<div class="row-fluid">
	<div class="span12">
		<div class="row-fluid">
			<div class="span12" style="text-transform: uppercase;">
				<h5>(Optional) Add an image or screenshot to your description</h5>
			</div>
		</div>

		<script type="text/javascript" src="{{STATIC_URL}}js/jquery.form.js"></script>
		<script type="text/javascript">
		$(document).ready(function() {
			 var options = {
				 target:    '#spc-item-upload-output-ajax-adds-it',
				 success: function() { $('#spc-item-upload-output-ajax-adds-it').fadeIn('slow'); },
				 url:       '{% url spc-screenshot-add %}',
				 type:      'post',
				 clearForm:  true,
				 resetForm:  true,
			};
			// bind form using 'ajaxForm'
			$('#spc-item-upload-add').ajaxForm(options);
		});
		</script>

		<form action="" method="post" enctype="multipart/form-data" id="spc-item-upload-add">
			{% csrf_token %}
			<div class="control-group">
				<label class="control-label" for="spc_image_upload">Optionally upload <b>image file(s)</b> to use in your description</label>
				<div class="controls">
					<input type="file" placeholder="Choose" id="spc_image_upload" name="spc_image_upload">
				</div>
			</div>
			
			<div class="control-group">
				<div class="controls">
					<button class="btn btn-primary" type="submit"  name="spc-preview">Upload image</button>
					JPEG or PNG
				</div>
			</div>
		</form>
		<div id="spc-item-upload-output-ajax-adds-it"></div>
	</div>
	</div><!--/row-fluid-->
	
	
</div>
</div><!--/row-fluid-->
{% endblock %}
